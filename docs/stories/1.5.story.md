# Story 1.5: Frontend Performance Optimization

## Status

**Draft**

---

## Story

**As a** platform user,
**I want** fast page loads and responsive UI interactions,
**so that** I can analyze financial data without waiting for slow renders.

---

## Acceptance Criteria

1. Initial bundle size reduced by 20%
2. Code splitting implemented for routes
3. Lazy loading for non-critical components
4. Core Web Vitals meet "Good" threshold (LCP < 2.5s, FID < 100ms, CLS < 0.1)
5. Image optimization implemented

---

## Tasks / Subtasks

- [ ] **Task 1: Baseline Bundle Analysis** (AC: 1)
  - [ ] 1.1 Run `npm run build` and document current bundle sizes
  - [ ] 1.2 Analyze bundle with `vite-bundle-visualizer` or similar
  - [ ] 1.3 Identify largest dependencies and unused code
  - [ ] 1.4 Document Core Web Vitals baseline using Lighthouse

- [ ] **Task 2: Code Splitting & Lazy Loading** (AC: 2, 3)
  - [ ] 2.1 Implement route-based code splitting with React.lazy()
  - [ ] 2.2 Add lazy loading for heavy components:
    - TradingChart (recharts/lightweight-charts)
    - InsightsPage (d3/gauge components)
    - FeedbackPage (image upload widgets)
  - [ ] 2.3 Add Suspense boundaries with loading states
  - [ ] 2.4 Verify chunk splitting in production build

- [ ] **Task 3: Bundle Size Reduction** (AC: 1)
  - [ ] 3.1 Audit and remove unused dependencies
  - [ ] 3.2 Replace heavy libraries with lighter alternatives where possible
  - [ ] 3.3 Tree-shake unused exports (verify in Vite config)
  - [ ] 3.4 Verify 20% bundle size reduction

- [ ] **Task 4: Core Web Vitals Optimization** (AC: 4)
  - [ ] 4.1 Optimize Largest Contentful Paint (LCP):
    - Preload critical fonts
    - Optimize above-the-fold rendering
  - [ ] 4.2 Optimize First Input Delay (FID):
    - Minimize main thread blocking
    - Defer non-critical JavaScript
  - [ ] 4.3 Optimize Cumulative Layout Shift (CLS):
    - Set explicit dimensions on images/charts
    - Reserve space for dynamic content

- [ ] **Task 5: Image Optimization** (AC: 5)
  - [ ] 5.1 Implement lazy loading for images
  - [ ] 5.2 Add responsive image sizing (srcset)
  - [ ] 5.3 Optimize image formats (WebP where supported)
  - [ ] 5.4 Configure CDN caching headers (if applicable)

---

## Dev Notes

### Relevant Source Tree

```
frontend/
├── src/
│   ├── main.tsx                        # Entry point
│   ├── App.tsx                         # Root component with routing
│   ├── pages/
│   │   ├── PortfolioDashboard.tsx      # Heavy - charts, portfolio data
│   │   ├── FeedbackPage.tsx            # Image upload widgets
│   │   ├── InsightsPage.tsx            # D3/gauge visualizations
│   │   ├── TransactionHistory.tsx      # Table components
│   │   └── HealthPage.tsx              # Admin health dashboard
│   ├── components/
│   │   ├── TradingChart.tsx            # Lightweight-charts integration
│   │   ├── EnhancedChatInterface.tsx   # Main chat UI
│   │   ├── chart/                      # Chart components
│   │   ├── insights/                   # Visualization components
│   │   └── portfolio/                  # Portfolio widgets
│   └── services/
│       └── api.ts                      # API client
├── package.json                        # Dependencies
├── vite.config.ts                      # Build configuration
└── index.html                          # HTML template
```

### Technical Context

**Current Stack**:
- React 18 + TypeScript 5
- Vite for bundling
- TailwindCSS for styling
- React Router for navigation
- i18next for internationalization

**Heavy Dependencies to Consider**:
- `recharts` / `lightweight-charts` - Chart libraries
- `@tanstack/react-query` - Data fetching
- `i18next` - Internationalization bundles
- `d3` - Used in InsightsPage for gauges

**Code Splitting Pattern**:
```typescript
// Example: Lazy load a page component
const InsightsPage = lazy(() => import('./pages/InsightsPage'));

// In routes:
<Suspense fallback={<LoadingSpinner />}>
  <InsightsPage />
</Suspense>
```

### Previous Story Insights

**Story 1.1 Findings**:
- Frontend bundle size analysis pending
- Lighthouse scores to be established as baseline

---

## Testing

### Testing Standards [Source: docs/development/testing-strategy.md]

**Test Location**: `frontend/src/__tests__/` (if exists) or co-located

**Frontend Testing**:
- Framework: Vitest
- Run: `docker compose exec frontend npm test`

**For This Story**:
- Manual Lighthouse testing for Core Web Vitals
- Visual regression testing for lazy-loaded components
- Bundle size comparison (before/after)

---

## Change Log

| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2025-12-23 | 1.0 | Story created from epic definition | Bob (SM) |

---

## Dev Agent Record

### Agent Model Used

*(To be filled by Dev Agent)*

### Debug Log References

*(To be filled by Dev Agent)*

### Completion Notes List

*(To be filled by Dev Agent)*

### File List

*(To be filled by Dev Agent)*

---

## QA Results

*(To be filled by QA Agent)*
