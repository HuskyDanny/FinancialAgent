# Frontend v0.8.14

**Release Date**: 2025-10-31
**Docker Image**: `financial-agent/frontend:0.8.14`

## Overview

This release adds image upload functionality to feedback submissions with a drag-and-drop interface. Users can attach up to 5 images per feedback item, with real-time progress tracking and inline image display in the detail view. The implementation integrates with the backend's OSS (Alibaba Cloud Object Storage) service for secure, direct-to-cloud uploads.

## Features Added

- **Image Upload Widget** (`ImageUploadWidget.tsx`)
  - Drag-and-drop file upload interface
  - Click-to-browse file selection
  - Real-time upload progress bars
  - Image preview with remove button
  - Support for PNG, JPEG, GIF, WebP (max 10MB per file)
  - Maximum 5 images per feedback item
  - User-friendly error messages
- **Inline Image Display** (`FeedbackDetailView.tsx`)
  - Images displayed inline with feedback description
  - Click to open full-size image in new tab
  - Lazy loading for performance
  - Attachment counter with descriptive labels
- **OSS Upload API Integration** (`feedbackApi.ts`)
  - `generateUploadUrl()`: Request presigned URL from backend
  - `uploadImageToOSS()`: Direct upload to OSS using presigned URL
  - Proper error handling and type safety

## UI/UX Improvements

- **Drag-and-Drop Experience**:
  - Visual feedback with border color change on drag-over
  - Upload icon with clear instructions
  - Supported format display
  - File size and count limits shown
- **Upload Progress**:
  - Progress bar shows 0% → 50% (getting URL) → 100% (upload complete)
  - Success state with brief display before cleanup
  - Error state with retry option
- **Image Management**:
  - Preview thumbnails during upload
  - Remove button for each uploaded image
  - Automatic cleanup of object URLs to prevent memory leaks

## Technical Details

**New Components**:
- `frontend/src/components/feedback/ImageUploadWidget.tsx` (299 lines)

**Modified Components**:
- `frontend/src/components/feedback/FeedbackDetailView.tsx` (added inline image display)
- `frontend/src/services/feedbackApi.ts` (added upload methods)

**State Management**:
```typescript
// Upload tracking
interface UploadingImage {
  file: File;
  preview: string;        // Object URL for preview
  progress: number;       // 0-100
  error?: string;
}

// Upload flow
uploadingImages: UploadingImage[]  // Currently uploading
uploadedImages: string[]            // Successfully uploaded URLs
```

**Upload Flow**:
1. User selects/drops image → Create preview with `URL.createObjectURL()`
2. Request presigned URL from backend → Update progress to 50%
3. Upload to OSS using presigned URL → Update progress to 100%
4. Add public URL to `uploadedImages` array
5. Cleanup: Remove from `uploadingImages`, revoke object URL

**Performance Optimizations**:
- Lazy loading for images in detail view
- Automatic object URL cleanup with `URL.revokeObjectURL()`
- Preview cleanup 500ms after upload completion

## Breaking Changes

None

## Compatibility

| Component | Required Version | Notes |
|-----------|-----------------|-------|
| Backend | v0.5.11+ | Required for image upload API |
| Browser | Modern browsers | Requires File API, Drag & Drop API |

**Supported File Types**:
- PNG (image/png)
- JPEG (image/jpeg)
- GIF (image/gif)
- WebP (image/webp)

**Constraints**:
- Max file size: 10MB per image
- Max images: 5 per feedback item
- Upload rate limit: 10 per minute per user

## Known Issues

**Performance Considerations** (Low Priority):
- Sequential file uploads (could parallelize for faster multi-file uploads)
- Multiple state updates during upload (minor re-render impact)
- No image compression before upload

**Future Enhancements**:
- Parallel upload support for multiple images
- Image compression/resizing before upload
- Image rotation/editing tools
- Copy-paste image support
- Progress persistence across page refreshes

## Migration Guide

**For Users**:

No migration required - feature is additive. Existing feedback items without images continue to work normally.

**For Developers**:

1. Pull latest code with frontend v0.8.14 and backend v0.5.11

2. Ensure OSS credentials are configured in backend (see backend v0.5.11 migration guide)

3. Restart containers:
   ```bash
   docker compose restart backend frontend
   ```

4. Test image upload:
   - Navigate to Feedback page
   - Click "New Feedback"
   - Drag & drop an image or click to browse
   - Verify upload progress shows 0% → 50% → 100%
   - Submit feedback
   - View detail - image should display inline

**No frontend dependencies added** - uses native browser APIs and existing Axios.
