# Backend v0.6.0

**Release Date**: 2025-11-13
**Docker Image**: `financial-agent/backend:0.6.0`

## Overview

Major release adding Alpha Vantage market data integration and implementing 7 critical code review fixes covering error recovery, performance optimization, security, and reliability improvements.

## Features Added

- **Alpha Vantage Integration**: Complete integration with Alpha Vantage API for real-time and historical market data
  - Company Overview, News Sentiment, Earnings data endpoints
  - Market movers (top gainers/losers)
  - Comprehensive error handling and rate limiting
- **Agent Tool Integration**: New LangGraph tools for market data retrieval
  - `get_company_overview_tool`
  - `get_news_sentiment_tool`
  - `search_symbol_tool`
- **Message Pagination**: Backend support for paginated message history (offset-based)
- **Enhanced Market Data API**: New endpoints for market search and Alpha Vantage data proxying

## Bug Fixes & Improvements

### Code Review Fixes (7 total):
- **C1 - Error Recovery**: Proper error boundaries for nested transaction saves
- **C2 - Agent Timeout**: 120-second timeout protection with transaction rollback
- **C3 - Debug Logging**: Moved verbose tool logging to debug level
- **M1 - Request Deduplication**: (Frontend only)
- **M2 - Input Validation**: (Frontend only)
- **M3 - Rendering Optimization**: (Frontend only)
- **M4 - Message Pagination**: Backend offset parameter support

### Additional Improvements:
- Refactored chat.py for better maintainability (reduced from 800+ to 500 lines)
- Improved error messages and user feedback
- Enhanced logging for debugging
- Better separation of concerns between API and service layers

## Technical Details

### API Changes:
- `GET /api/chat/{chat_id}` now accepts `offset` query parameter for pagination
- New `/api/market` endpoints for Alpha Vantage integration
- New `/api/analysis` endpoints moved from chat module

### Database Changes:
- Message repository now supports offset-based pagination
- Tool call metadata added to message model

### Configuration:
- New `ALPHA_VANTAGE_API_KEY` environment variable required
- Alpha Vantage integration can be enabled/disabled via config

## Breaking Changes

None - all changes are backward compatible

## Compatibility

| Component | Required Version |
|-----------|-----------------|
| Frontend | 0.9.0 |
| MongoDB | 7.0+ |
| Redis | 7.2+ |
| Python | 3.12+ |

## Known Issues

None

## Migration Guide

1. Add `ALPHA_VANTAGE_API_KEY` to environment variables (optional, for market data features)
2. Update frontend to v0.9.0 for full feature compatibility
3. No database migrations required - changes are backward compatible

## Testing

All changes have been manually tested following comprehensive E2E test procedures covering:
- Input validation
- Message pagination
- Request deduplication
- Error recovery
- Agent timeout protection
- Debug logging
- Rendering optimization
