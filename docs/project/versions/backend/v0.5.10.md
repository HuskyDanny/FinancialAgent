# Backend v0.5.10

**Release Date**: 2025-10-30
**Docker Image**: `klinematrix/backend:test-v0.5.10`

## Overview

Improved Fibonacci trend detection with configurable tolerance per timeframe for better market segmentation. Daily tolerance refined from hardcoded 3% to optimized 0.7% based on extensive experimentation.

## Features Added

- **Configurable tolerance per timeframe**: Each timeframe (1h, 1d, 1w, 1M) now has its own tolerance threshold
  - Hourly: 0.5% (short-term sensitivity)
  - Daily: 0.7% (optimal balance - changed from 3% hardcoded)
  - Weekly: 2% (medium-term consolidation)
  - Monthly: 3% (long-term trends)
- **Better trend segmentation**: MSFT Aug-Oct now detects 5 distinct trends instead of 1 continuous uptrend
- **Improved trend classification**: Correctly identifies Aug 28-Sep 4 as downtrend (was uptrend with 1% tolerance)

## Technical Details

### Files Changed
- `backend/src/core/analysis/fibonacci/config.py`: Added `tolerance_pct` field to `TimeframeConfig`
- `backend/src/core/analysis/fibonacci/trend_detector.py`: Use `self.config.tolerance_pct` instead of hardcoded 0.03
- Test fixtures updated to reflect new tolerance values

### Algorithm Improvements
- **Directional Greedy Accumulation**: Now respects timeframe-specific tolerance for pullback detection
- **Tolerance Sensitivity Analysis**: Experimentation showed:
  - 3% tolerance: Too permissive (merged distinct trends)
  - 1.5% tolerance: Still merged some movements
  - 1.0% tolerance: Good segmentation
  - **0.7% tolerance: Optimal balance** (captures intermediate trends without over-segmentation)
  - 0.5% tolerance: Over-segmentation (noise)

### Validation
- All 28 tests pass (13 trend detection + 15 utils/config)
- MSFT test case: 5 trends detected (vs expected 4 from chart analysis)
- Trend classification accuracy improved

## Bug Fixes

None - this is a feature enhancement release

## Breaking Changes

None - backward compatible configuration structure

## Compatibility

| Component | Required Version |
|-----------|------------------|
| Frontend | v0.8.12+ (no changes required) |
| MongoDB | v7.0+ |
| Redis | v7.2+ |

## Known Issues

None

## Migration Guide

No migration required. The new tolerance configuration is applied automatically on backend restart.

### For Local Development
```bash
# Restart backend to pick up new config
docker compose restart backend
```

### For Kubernetes Deployment
```bash
# Build new image
az acr build --registry financialAgent \
  --image klinematrix/backend:test-v0.5.10 \
  --file backend/Dockerfile backend/

# Update kustomization.yaml with new version
# Apply and restart
kubectl apply -k .pipeline/k8s/overlays/test
kubectl rollout restart deployment/backend -n klinematrix-test
```

## Git Commits

- `30467a0`: feat(fibonacci): Make tolerance configurable per timeframe for better segmentation
- `964a9f7`: refine(fibonacci): Tighten daily tolerance to 0.7% for better trend segmentation
