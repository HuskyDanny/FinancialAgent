# backend v0.3.0

**Release Date**: 2025-10-04
**Docker Image**: `financial-agent/backend:0.3.0`

## Overview

This release introduces real-time streaming LLM responses with DashScope Qwen integration, enhanced system prompts for Wall Street analyst persona, and improved chat agent architecture.

## Features Added

- **Streaming LLM Responses**: Real-time token-by-token streaming using DashScope Qwen API
- **Enhanced System Prompt**: Wall Street senior analyst persona with "Compact Logic Book" structure (Verdict → Evidence → Insights & Action → Caveat)
- **SSE Endpoints**: Server-Sent Events for `/api/chat/stream` with proper buffer flushing
- **Token Limits**: Configurable max_tokens up to 3000 with high signal-to-noise ratio requirements
- **Session Management**: Improved chat session tracking with session_id support
- **Async Streaming**: `astream_chat()` and `stream_chat()` methods with `asyncio.sleep(0)` for immediate buffer flushing

## Technical Improvements

- **LLM Client**: Enhanced `llm_client.py` with streaming support and incremental output
- **Chat Agent**: Updated `chat_agent.py` with `stream_chat()` method for async streaming
- **API Endpoints**: New `/api/chat/stream` endpoint with X-Accel-Buffering headers for uvicorn compatibility

## Bug Fixes

- Fixed uvicorn HTTP response buffering issue with `await asyncio.sleep(0)` pattern
- Improved streaming chunk delivery for real-time user experience

## Breaking Changes

None - streaming is additive, existing `/api/chat` endpoint remains unchanged

## Compatibility

| Component | Required Version |
|-----------|-----------------|
| DashScope | Latest |
| Python | 3.12+ |
| FastAPI | Latest |
| Redis | Any |
| MongoDB | Any |

## Known Issues

None

## Migration Guide

No migration required. The existing chat endpoint continues to work. To use streaming:

```python
# Frontend: Use new streaming endpoint
fetch('/api/chat/stream', {
  method: 'POST',
  headers: { 'Content-Type': 'application/json' },
  body: JSON.stringify({ message: 'Your question', session_id: sessionId })
})
```
