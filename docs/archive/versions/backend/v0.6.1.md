# Backend v0.6.1

**Release Date**: 2025-11-14
**Docker Image**: `financialagent-gxftdbbre4gtegea.azurecr.io/klinecubic/backend:prod-v0.6.1`

## Overview

Patch release fixing Kubernetes metrics collection for the admin dashboard. Adds proper RBAC permissions and namespace configuration for metrics API access.

## Features Added

None

## Bug Fixes

- **K8s Metrics Permission Denied**: Fixed 403 Forbidden errors when accessing pod/node metrics
  - Added `KUBERNETES_NAMESPACE` environment variable (configurable via Settings)
  - Updated RBAC Role to include `metrics.k8s.io/pods` permissions
  - Added ClusterRole + ClusterRoleBinding for `metrics.k8s.io/nodes` (cluster-scoped)
  - Changed default namespace from hardcoded "klinematrix-test" to environment-based configuration
  - Admin dashboard now correctly displays pod and node metrics in production

## Technical Changes

- **Config**: Added `kubernetes_namespace` setting in `src/core/config.py`
- **Dependency Injection**: Updated `get_kubernetes_metrics_service()` to use settings-based namespace
- **RBAC**: Enhanced permissions in `.pipeline/k8s/overlays/prod/rbac.yaml`
  - Role: Added `metrics.k8s.io` API group for pods
  - ClusterRole: Added cluster-wide permissions for nodes metrics
- **Deployment**: Added `KUBERNETES_NAMESPACE=klinematrix-prod` env var to backend deployment

## Breaking Changes

None

## Compatibility

| Component | Required Version |
|-----------|-----------------|
| Kubernetes | v1.34.1+ (metrics-server required) |
| RBAC | ClusterRole/ClusterRoleBinding support |

## Known Issues

None

## Migration Guide

No migration required. RBAC updates are automatically applied via `kubectl apply -f rbac.yaml`.
Existing deployments will use environment variable from deployment patch.
