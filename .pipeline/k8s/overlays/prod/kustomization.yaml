apiVersion: kustomize.config.k8s.io/v1beta1
kind: Kustomization

metadata:
  name: klinecubic-prod

# Production namespace
namespace: klinematrix-prod

# Base configuration
resources:
# Base resources (excluding Langfuse, namespace, and Azure workload identity)
- ../../base/backend/deployment.yaml
- ../../base/backend/service.yaml
- ../../base/frontend/deployment.yaml
- ../../base/frontend/service.yaml
- ../../base/redis/deployment.yaml
- ../../base/redis/service.yaml
- ../../base/redis/configmap.yaml
- ../../base/redis/secret.yaml
- ../../base/ingress/clusterissuer.yaml
- ../../base/ingress/ingress.yaml
- ../../base/cronjobs/reconcile-transactions.yaml
- ../../base/cronjobs/portfolio-analysis.yaml
# Production-specific resources (Alibaba Cloud ACK)
- namespace.yaml
- mongodb-statefulset.yaml
- mongodb-service.yaml
# Note: secrets.yaml references External Secrets Operator (not installed in ACK)
# Secrets are managed manually via kubectl in production
- rbac.yaml

# Production environment overrides
patches:
- path: backend-prod-patch.yaml
  target:
    kind: Deployment
    name: backend
- path: frontend-prod-patch.yaml
  target:
    kind: Deployment
    name: frontend
- path: ingress-prod-patch.yaml
  target:
    kind: Ingress
    name: klinematrix-ingress
- path: cronjob-portfolio-analysis-patch.yaml
  target:
    kind: CronJob
    name: portfolio-analysis

# Production image tags (current versions)
images:
- name: klinematrix/backend
  newName: financialagent-gxftdbbre4gtegea.azurecr.io/klinecubic/backend
  newTag: "prod-v0.8.0"
- name: klinematrix/frontend
  newName: financialagent-gxftdbbre4gtegea.azurecr.io/klinecubic/frontend
  newTag: "prod-v0.11.0"

# Resource allocation for production
replicas:
- name: backend
  count: 1
- name: frontend
  count: 1
