apiVersion: kustomize.config.k8s.io/v1beta1
kind: Kustomization

metadata:
  name: klinematrix-prod

# Production namespace
namespace: klinematrix-prod

# Base configuration (Phase 1: No Langfuse)
resources:
# Backend & Frontend
- ../../base/backend/deployment.yaml
- ../../base/backend/service.yaml
- ../../base/frontend/deployment.yaml
- ../../base/frontend/service.yaml

# Redis (self-hosted cache)
- ../../base/redis/deployment.yaml
- ../../base/redis/service.yaml
- ../../base/redis/configmap.yaml
- ../../base/redis/secret.yaml

# Ingress & TLS
- ../../base/ingress/clusterissuer.yaml
- ../../base/ingress/ingress.yaml

# Production-specific resources
- namespace.yaml
- mongodb-statefulset.yaml
- mongodb-service.yaml
- secrets.yaml
- rbac.yaml

# Production environment overrides
patchesStrategicMerge:
- backend-prod-patch.yaml
- frontend-prod-patch.yaml
- ingress-prod-patch.yaml

# Environment-specific labels
commonLabels:
  environment: prod

# Production image tags (current versions)
images:
- name: klinematrix/backend
  newName: financialagent-gxftdbbre4gtegea.azurecr.io/klinematrix/backend
  newTag: "test-v0.5.14"
- name: klinematrix/frontend
  newName: financialagent-gxftdbbre4gtegea.azurecr.io/klinematrix/frontend
  newTag: "test-v0.8.14"

# Resource allocation for production (Phase 1: No Langfuse)
replicas:
- name: backend
  count: 1
- name: frontend
  count: 1
