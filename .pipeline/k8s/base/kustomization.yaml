apiVersion: kustomize.config.k8s.io/v1beta1
kind: Kustomization

metadata:
  name: klinematrix-base

resources:
- namespace.yaml
- workload-identity/serviceaccount.yaml
- backend/deployment.yaml
- backend/service.yaml
- frontend/deployment.yaml
- frontend/service.yaml
- redis/deployment.yaml
- redis/service.yaml
- redis/configmap.yaml
- redis/secret.yaml
- langfuse/clickhouse-statefulset.yaml
- langfuse/clickhouse-service.yaml
- langfuse/server-deployment.yaml
- langfuse/server-service.yaml
- langfuse/worker-deployment.yaml
- langfuse/db-init-job.yaml
- langfuse/ingress.yaml
- ingress/clusterissuer.yaml
- ingress/ingress.yaml
- cronjobs/reconcile-transactions.yaml
# Deprecated: Migrated to HTTP trigger pattern (see docs/features/portfolio-analysis-cronjob-http.md)
# - cronjobs/portfolio-analysis.yaml
- cronjobs/portfolio-analysis-trigger.yaml  # Lightweight HTTP trigger (5MB vs 1.14GB)
- cronjobs/insights-snapshot-trigger.yaml   # Daily insights snapshot trigger

commonLabels:
  app.kubernetes.io/name: klinematrix
  app.kubernetes.io/version: "0.6.1"

images:
- name: klinematrix/backend
  newName: financialagent-gxftdbbre4gtegea.azurecr.io/klinematrix/backend
  newTag: "test-v0.5.6"
- name: klinematrix/frontend
  newName: financialagent-gxftdbbre4gtegea.azurecr.io/klinematrix/frontend
  newTag: "test-v0.8.7"
